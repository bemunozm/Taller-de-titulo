# Environment variables for lpr (manager + workers)
# Copy/rename this file to .env (or load it into tu entorno) and ajusta los valores antes de ejecutar.

# ---------------- Manager / Backend integration ----------------
# URL base del backend (usado por reconciliación y pasado a los workers)
WORKER_BACKEND_URL=http://localhost:3000/api/v1
# Si el backend protege la API de cámaras, pon aquí un Bearer token para que el manager pueda consultar /cameras
WORKER_BACKEND_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImQ3Y2JhMWU4LWRhMTMtNDI1Ny04ZGIwLTI1ZmRkZTMxNDQ1NSIsImVtYWlsIjoiYmVuLm11bm96bUBnbWFpbC5jb20iLCJuYW1lIjoiQmVuamFtaW4gRWR1YXJkbyBNdcOxb3ogTW95YSIsInJvbGVJZHMiOlsiMjI4OWQyNDUtMjZhNC00MjRkLTk4OGEtM2MxMDg4NzM3YWMxIiwiMDgyZDEwMGMtNWFlMi00MjYwLTk2NzgtMjI1MzJmNGYyM2I2Il0sImlzU2VydmljZVRva2VuIjp0cnVlLCJkZXNjcmlwdGlvbiI6IlRva2VuIHBhcmEgTFBSIFdvcmtlciBNYW5hZ2VyIiwiaWF0IjoxNzY1MTU0Mjk0LCJleHAiOjE3OTY2OTAyOTR9._s3FZXMls9VHxGOEHSdQdrytLq7kW7T91dY0481Vgi0
# Secreto compartido entre backend y manager. Debe coincidir con WORKER_MANAGER_SECRET en el backend
WORKER_MANAGER_SECRET=change-me-to-a-secure-random-value
# Puerto donde el manager expondrá su API
WORKER_MANAGER_PORT=8000

# ---------------- LPR worker configuration (desde lpr/config.py) ----------------
# RTSP URL por defecto (SOLO para pruebas locales). En producción el manager pasará la URL desde el backend.
# Si dejas estas variables vacías, el worker esperará recibir la URL/cameraId como argumentos desde el manager.
LPR_RTSP_URL=
# Identificador de la cámara (SOLO para pruebas locales)
LPR_CAMERA_ID=
# Endpoint del backend donde el worker enviará eventos (detecciones). Valor por defecto apuntando al backend local
LPR_BACKEND_URL=http://localhost:3000/api/v1
# Intervalo de polling / captura en segundos
LPR_POLL_INTERVAL=1.0
# Dry-run: usa 'true' para que el worker no envíe POSTs al backend (útil para pruebas)
LPR_DRY_RUN=false

# Model overrides
LPR_DETECTOR_MODEL=morsetechlab/yolov11-license-plate-detection
LPR_OCR_MODEL=cct-s-v1-global-model

# Thresholds / paths
LPR_MIN_DET_CONF=0.30
LPR_DETECTIONS_DIR=./lpr/detecciones
LPR_SAVE_CROPS_DIR=./lpr/detecciones/crops
LPR_SAVE_FRAMES_DIR=./lpr/detecciones/frames
LPR_DET_HIGH_CONF=0.55
LPR_OCR_HIGH_CONF=0.98

# Opciones extra
LPR_MIN_EVENT_INTERVAL=2.0
LPR_FORCE_SAVE_ON_OCR=true

# ---------------- Cloudinary (opcional) ----------------
# Si quieres que el worker suba frames/detecciones a Cloudinary, completa
# las tres variables siguientes y activa CLOUDINARY_UPLOAD=1
# Nota: por seguridad la subida está DESACTIVADA por defecto.
CLOUDINARY_CLOUD_NAME=di8z2v0zf
CLOUDINARY_API_KEY=771682855135796
CLOUDINARY_API_SECRET=bw7puZKlDb0iSltZDPGkvBFy4vE
# Activar la subida a Cloudinary (0/false desactiva, 1/true activa)
CLOUDINARY_UPLOAD=1
# Si se activa, borrar localmente los archivos tras subir (0/1)
CLOUDINARY_DELETE_LOCAL=1

# Incluir o no el snapshot (crop) codificado en base64 dentro de meta.snapshot_jpeg_b64
# 1 = incluir (por defecto útil en desarrollo), 0 = no incluir (reduce tamaño de payload)
LPR_INCLUDE_SNAPSHOT=0

# ---------------- Opciones avanzadas / umbrales / tokens ----------------
# Controla si se guardan crops solo cuando OCR devuelve texto (1/0)
LPR_SAVE_ONLY_ON_PLATE=1
# Ratio mínimo de caracteres con confianza para aceptar (0-1)
LPR_MIN_CHAR_CONF_RATIO=0.6
# Segundos para deduplicar la misma placa (aumentado para tests con videos repetidos)
LPR_DEDUP_SECONDS=360
# Thresholds usados en runtime para decidir guardar/emitir
LPR_DET_CONF_THRESHOLD=0.55
LPR_OCR_CONF_THRESHOLD=0.98
# Confirmación: cuántos frames deben verse para confirmar (frames) y segundos
# Reducido para tests con videos de 3-5 segundos por patente
LPR_CONFIRM_FRAMES=5
LPR_CONFIRM_SECONDS=3
# Parámetros para combinación/confianza
LPR_COMBINED_ALPHA=0.75
LPR_COMBINED_THRESHOLD=0.3
# Regex opcional para validar placas (dejar vacío para usar el default codificado)
LPR_PLATE_REGEX=
# Umbral mínimo por caracter (rules.py usa LPR_MIN_CHAR_CONF)
LPR_MIN_CHAR_CONF=0.30

# Token que puede usar el worker para autenticarse en el backend (si aplica)
LPR_WORKER_TOKEN=

# Cloudinary: reintentos y backoff para upload_to_cloudinary
CLOUDINARY_UPLOAD_RETRIES=3
CLOUDINARY_RETRY_BACKOFF=1.0

# Opciones del manager local (ejecutar lpr/manager.py)
WORKER_MANAGER_HOST=0.0.0.0
WORKER_MANAGER_PORT=8000
WORKER_MANAGER_RELOAD=0
WORKER_MANAGER_WORKERS=1

# Nota: ajusta estos valores según el entorno. No incluyas credenciales reales en repositorios públicos.
LOG_LEVEL=DEBUG